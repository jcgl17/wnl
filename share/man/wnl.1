.\" Manpage for wnl and wnlctl
.Dd 2024-06-01
.Dt WNL 1
.Os

.Sh NAME
.Nm wnl
.Nd Wait 'n' Listen: bind and trigger long-running shell commands

.Sh SYNOPSIS
.Nm wnl
.Op Ar SLOT_ID
.Ar COMMAND
.Op Ar ARGUMENTS ...
.Nm wnlctl
.Op Ar SLOT_ID

.Sh DESCRIPTION
.Pp
.Nm wnl
helps create a "Unix as IDE" workflow: you bind a frequently re-run command with
.Nm wnl\c ,
then trigger it from anywhere with
.Nm wnlctl\c .

.Pp
A typical workflow:

.Bl -enum
.It
Bind a command in one shell with
.Nm wnl
.Dl $ wnl make test

.It
Trigger or re-trigger that command from another shell with
.Nm wnlctl
.Dl $ wnlctl 1
.Pp
Or bind
.Cm wnlctl 1
to a keyboard shortcut within your Desktop Environment.

.It
(optional) Interrupt the running command with
.Nm wnlctl
.Dl $ SIGNAL=USR2 wnlctl 1

.It
When you're done with this command, un-bind by exiting
.Nm wnl
with
.Cm Ctrl-c
.El

.Sh OPTIONS
.Bl -tag -width "SLOT_ID"
.It Ar SLOT_ID
Numeric identifier of the slot. If omitted,
.Nm wnl
picks the first free slot (counting up from 1).
.Nm wnlctl defaults to slot 1.
.El

.Sh ENVIRONMENT
.Bl -tag -width "SIGNAL"
.It Ev SIGNAL
Signal that is used to communicate with
.Nm wnl\c .
Either
.Cm USR1
tells 
.Nm wnl
to start command execution, and
.Cm USR2
tells 
.Nm wnl
to terminate execution.

.Cm USR1
is sent if this is not specified.
.El

.Sh FILES
User configuration file:
.Pa ~/.config/wnl/wnlrc

The only interesting things to configure are hooks. Hooks are shell snippets that are executed at various points in wnl's lifecycle:

.Bl -tag
.It Cm HOOK_STARTUP
Run once when
.Nm wnl
starts

.It Cm HOOK_PRE
Run just before each invocation of your command.

.It Cm HOOK_POST
Run just after each invocation.  The variable
.Va EXIT_CODE
contains the command’s exit status.

.It Cm HOOK_EXIT
Run when
.Nm wnl
exits (after you hit Ctrl-c)
.El

Example
.Fa wnlrc :
.Bd -literal
HOOK_PRE='pw-play /usr/share/sounds/ocean/stereo/service-logout.oga &'
HOOK_POST='test "$EXIT_CODE" -eq 0 || pw-play /usr/share/sounds/oxygen/stereo/message-connectivity-error.ogg &'
HOOK_EXIT='echo "$FMT_GREEN$FMT_BOLD"; cowsay thanks for using wnl; echo "$FMT_NORMAL"'
.Ed

.Sh EXAMPLES
.Bl -enum
.It
Run tests in the next free slot:
.Dl $ wnl make test

.It
Trigger slot 1 (for example, bound to Ctrl-F1 in your Desktop Environment):
.Dl $ wnlctl 1

.It
Abort the command in slot 1 (for example, bound to Ctrl-Shift-F1 in your Desktop Environment):
.Dl $ SIGNAL=USR2 wnlctl 1
.El

.Sh SEE ALSO
.Xr entr 1
— another Unix-as-IDE tool

.Sh BUGS
Report bugs at
.Li https://codeberg.org/jcgl/wnl/issues
or email
.Li j@cgl.sh

